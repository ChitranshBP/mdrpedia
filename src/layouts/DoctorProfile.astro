---
/**
 * MDRPedia ‚Äî Doctor Profile Layout
 * Premium Wikipedia-style profile with:
 * - Tier-colored Aura Glow header
 * - PrestigeBadge SVG seals
 * - MediaVault gallery with lightbox
 * - Intersection Observer sidebar
 * - LEGACY watermark for historical
 * - CitePopup for citation selection
 * - ClaimProfile self-service portal
 */

import Layout from "./Layout.astro";
import TierBadge from "../components/TierBadge.astro";
import LivesCounter from "../components/LivesCounter.astro";
import JsonLd from "../components/JsonLd.astro";
import CitationSidebar from "../components/CitationSidebar.astro";
import ReferenceList from "../components/ReferenceList.astro";
import LegacyTimeline from "../components/LegacyTimeline.astro";
import BreadcrumbNav from "../components/BreadcrumbNav.astro";
import PrestigeBadge from "../components/PrestigeBadge.astro";
import MediaVault from "../components/MediaVault.astro";
import ClaimProfile from "../components/ClaimProfile.astro";
import CitePopup from "../components/CitePopup.astro";
import AISummary from "../components/AISummary.astro";
import CitationHover from "../components/CitationHover.astro";
import ResearchHighlights from "../components/ResearchHighlights.astro";
import { generateAISummary } from "../lib/ai-summary";

interface Props {
    doctor: {
        fullName: string;
        title?: string;
        specialty: string;
        subSpecialty?: string;
        geography: { country: string; region?: string; city?: string };
        status: "LIVING" | "HISTORICAL";
        tier: "TITAN" | "ELITE" | "MASTER" | "UNRANKED";
        rankingScore?: number;
        hIndex: number;
        yearsActive: number;
        verifiedSurgeries: number;
        biography?: string;
        portraitUrl?: string;
        galleryUrls?: string[];
        livesSaved: number;
        techniquesInvented: string[];
        hasInvention: boolean;
        dateOfBirth?: string;
        dateOfDeath?: string;
        // GEO-enhanced fields
        npiNumber?: string;
        orcidId?: string;
        medicalSpecialty?: string[];
        knowsAbout?: string[];
        affiliations?: {
            hospitalName: string;
            role?: string;
            hospitalUrl?: string;
        }[];
        aiSummary?: string;
        citations?: {
            doi?: string;
            pubmedId?: string;
            title: string;
            journal?: string;
            year?: number;
            verified?: boolean;
            abstract?: string;
            totalCitationCount?: number;
            evidenceClassification?: string;
            isOpenAccess?: boolean;
            openAccessUrl?: string;
        }[];
        awards?: { name: string; year: number; issuingBody?: string }[];
        timeline?: { year: number; title: string; description?: string }[];
    };
}

const { doctor } = Astro.props;
const slug = Astro.url.pathname.split("/").filter(Boolean).pop() || "";

const isHistorical = doctor.status === "HISTORICAL";

// Generate AI Summary if not provided
const aiSummary =
    doctor.aiSummary ||
    generateAISummary({
        fullName: doctor.fullName,
        specialty: doctor.specialty,
        subSpecialty: doctor.subSpecialty,
        tier: doctor.tier,
        hIndex: doctor.hIndex,
        yearsActive: doctor.yearsActive,
        verifiedSurgeries: doctor.verifiedSurgeries,
        livesSaved: doctor.livesSaved,
        techniquesInvented: doctor.techniquesInvented,
        geography: doctor.geography,
        affiliations: doctor.affiliations,
        biography: doctor.biography,
        status: doctor.status,
        dateOfBirth: doctor.dateOfBirth,
        dateOfDeath: doctor.dateOfDeath,
        citations: doctor.citations,
        awards: doctor.awards,
    });
const isTitan = doctor.tier === "TITAN";
const location = [
    doctor.geography.city,
    doctor.geography.region,
    doctor.geography.country,
]
    .filter(Boolean)
    .join(", ");

const tierGradients: Record<string, string> = {
    TITAN: "linear-gradient(135deg, #300066 0%, #1a0033 40%, #300066 100%)",
    ELITE: "linear-gradient(135deg, #001a4d 0%, #002266 40%, #001a4d 100%)",
    MASTER: "linear-gradient(135deg, #003322 0%, #004d33 40%, #003322 100%)",
    UNRANKED: "linear-gradient(135deg, #1a1a2e 0%, #16162a 40%, #1a1a2e 100%)",
};

const tierBorderColors: Record<string, string> = {
    TITAN: "#FFD700",
    ELITE: "#00aaff",
    MASTER: "#00cc66",
    UNRANKED: "#444466",
};

/* Sections for the sidebar Table of Contents */
const sections = [
    doctor.biography ? "Biography" : null,
    doctor.portraitUrl ? "Media" : null,
    doctor.techniquesInvented.length > 0 ? "Techniques" : null,
    doctor.awards && doctor.awards.length > 0 ? "Awards" : null,
    isHistorical && doctor.timeline && doctor.timeline.length > 0
        ? "Timeline"
        : null,
    doctor.citations && doctor.citations.length > 0 ? "Research" : null,
    doctor.citations && doctor.citations.length > 0 ? "References" : null,
].filter(Boolean) as string[];
---

<Layout
    title={`${doctor.fullName} ‚Äî MDRPedia`}
    description={doctor.biography ??
        `${doctor.fullName}, ${doctor.specialty} specialist in ${location}. MDRPedia verified profile.`}
>
    <JsonLd
        fullName={doctor.fullName}
        specialty={doctor.specialty}
        subSpecialty={doctor.subSpecialty}
        biography={doctor.biography}
        portraitUrl={doctor.portraitUrl}
        geography={doctor.geography}
        citations={doctor.citations}
        tier={doctor.tier}
        hIndex={doctor.hIndex}
        yearsActive={doctor.yearsActive}
        url={Astro.url.href}
        npiNumber={doctor.npiNumber}
        orcidId={doctor.orcidId}
        medicalSpecialty={doctor.medicalSpecialty}
        knowsAbout={doctor.knowsAbout}
        affiliations={doctor.affiliations}
        aiSummary={aiSummary}
        dateOfBirth={doctor.dateOfBirth}
        dateOfDeath={doctor.dateOfDeath}
    />

    <div class="container">
        <BreadcrumbNav
            geography={doctor.geography}
            specialty={doctor.specialty}
            doctorName={doctor.fullName}
        />
    </div>

    <!-- Hero Header with Aura Glow -->
    <header
        class:list={[
            "profile-hero",
            { "profile-hero--aura": isTitan },
            { "profile-hero--historical": isHistorical },
        ]}
        style={`background: ${tierGradients[doctor.tier]}; border-bottom: 3px solid ${tierBorderColors[doctor.tier]};`}
    >
        {
            isHistorical && (
                <div class="profile-hero__legacy-watermark">LEGACY</div>
            )
        }
        <div class="container">
            <div class="profile-hero__content">
                <div class="profile-hero__info">
                    <div class="profile-hero__badges">
                        <TierBadge tier={doctor.tier} size="lg" />
                        <PrestigeBadge tier={doctor.tier} size="md" />
                    </div>
                    <h1 class="profile-hero__name">
                        {doctor.fullName}
                        {
                            doctor.title && (
                                <span class="profile-hero__title">
                                    , {doctor.title}
                                </span>
                            )
                        }
                    </h1>
                    <p class="profile-hero__specialty">
                        {doctor.specialty}{
                            doctor.subSpecialty && ` ¬∑ ${doctor.subSpecialty}`
                        }
                    </p>
                    <p class="profile-hero__location">üìç {location}</p>

                    {
                        isHistorical &&
                            doctor.dateOfBirth &&
                            doctor.dateOfDeath && (
                                <p class="profile-hero__dates">
                                    {new Date(doctor.dateOfBirth).getFullYear()}{" "}
                                    ‚Äî{" "}
                                    {new Date(doctor.dateOfDeath).getFullYear()}
                                </p>
                            )
                    }

                    <div class="profile-hero__stats">
                        <div class="stat">
                            <span class="stat__value">{doctor.hIndex}</span>
                            <span class="stat__label">H-Index</span>
                        </div>
                        <div class="stat">
                            <span class="stat__value">{doctor.yearsActive}</span
                            >
                            <span class="stat__label">Years Active</span>
                        </div>
                        <div class="stat">
                            <span class="stat__value"
                                >{
                                    doctor.verifiedSurgeries.toLocaleString()
                                }</span
                            >
                            <span class="stat__label">Verified Surgeries</span>
                        </div>
                        {
                            doctor.techniquesInvented.length > 0 && (
                                <div class="stat">
                                    <span class="stat__value">
                                        {doctor.techniquesInvented.length}
                                    </span>
                                    <span class="stat__label">
                                        Techniques Invented
                                    </span>
                                </div>
                            )
                        }
                    </div>
                </div>

                {
                    doctor.portraitUrl && (
                        <div
                            class:list={[
                                "profile-hero__portrait",
                                { "historical-portrait": isHistorical },
                            ]}
                        >
                            <img
                                src={doctor.portraitUrl}
                                alt={doctor.fullName}
                                width="280"
                                height="280"
                                loading="eager"
                            />
                        </div>
                    )
                }
            </div>
        </div>
    </header>

    <!-- Lives Counter -->
    {
        doctor.livesSaved > 0 && (
            <section class="container" style="margin-top: var(--space-2xl);">
                <LivesCounter count={doctor.livesSaved} />
            </section>
        )
    }

    <!-- AI Summary (GEO-optimized TL;DR) -->
    <section class="container" style="margin-top: var(--space-xl);">
        <AISummary
            summary={aiSummary}
            tier={doctor.tier}
            fullName={doctor.fullName}
            hIndex={doctor.hIndex}
            specialty={doctor.specialty}
        />
    </section>

    <!-- Main Content + Sidebar -->
    <div class="container profile-body">
        <article class="profile-main">
            {
                doctor.biography && (
                    <section
                        class="profile-section"
                        id="section-biography"
                        data-section="Biography"
                    >
                        <h2>Biography</h2>
                        <p>{doctor.biography}</p>
                        {doctor.citations && doctor.citations.length > 0 && (
                            <p class="profile-section__citations">
                                {doctor.citations.slice(0, 3).map((c, i) => (
                                    <sup>
                                        <a
                                            href={`#ref-${i + 1}`}
                                            class="citation-link"
                                        >
                                            [{i + 1}]
                                        </a>
                                    </sup>
                                ))}
                            </p>
                        )}
                    </section>
                )
            }

            <!-- Media Vault -->
            {
                doctor.portraitUrl && (
                    <section
                        class="profile-section"
                        id="section-media"
                        data-section="Media"
                    >
                        <h2>Gallery of Authority</h2>
                        <MediaVault
                            portraitUrl={doctor.portraitUrl}
                            fullName={doctor.fullName}
                            galleryUrls={doctor.galleryUrls || []}
                            tier={doctor.tier}
                        />
                    </section>
                )
            }

            {
                doctor.techniquesInvented.length > 0 && (
                    <section
                        class="profile-section"
                        id="section-techniques"
                        data-section="Techniques"
                    >
                        <h2>Pioneering Techniques</h2>
                        <ul class="techniques-list">
                            {doctor.techniquesInvented.map((tech) => (
                                <li class="technique-item">
                                    <span class="technique-icon">‚ö°</span>
                                    {tech}
                                </li>
                            ))}
                        </ul>
                    </section>
                )
            }

            {
                doctor.awards && doctor.awards.length > 0 && (
                    <section
                        class="profile-section"
                        id="section-awards"
                        data-section="Awards"
                    >
                        <h2>Awards & Recognition</h2>
                        <div class="awards-grid">
                            {doctor.awards.map((award) => (
                                <div class="award-card">
                                    <span class="award-year">{award.year}</span>
                                    <h4 class="award-name">{award.name}</h4>
                                    {award.issuingBody && (
                                        <p class="award-body">
                                            {award.issuingBody}
                                        </p>
                                    )}
                                </div>
                            ))}
                        </div>
                    </section>
                )
            }

            {/* Legacy Timeline for Historical Profiles */}
            {
                isHistorical &&
                    doctor.timeline &&
                    doctor.timeline.length > 0 && (
                        <section id="section-timeline" data-section="Timeline">
                            <LegacyTimeline
                                entries={doctor.timeline}
                                doctorName={doctor.fullName}
                            />
                        </section>
                    )
            }

            {/* Research Highlights */}
            {
                doctor.citations && doctor.citations.length > 0 && (
                    <ResearchHighlights
                        citations={doctor.citations}
                        doctorName={doctor.fullName}
                    />
                )
            }

            {/* Wikipedia-Style References */}
            {
                doctor.citations && (
                    <section id="section-references" data-section="References">
                        <ReferenceList citations={doctor.citations} />
                    </section>
                )
            }

            <!-- Claim Profile Portal -->
            <ClaimProfile doctorName={doctor.fullName} slug={slug} />

            <slot />
        </article>

        <!-- Sticky Sidebar with Auto-Highlighting TOC -->
        <aside class="profile-sidebar" id="profileSidebar">
            {
                doctor.citations && doctor.citations.length > 0 && (
                    <CitationSidebar citations={doctor.citations} />
                )
            }

            <!-- Table of Contents -->
            <nav class="toc" id="tableOfContents">
                <h4 class="toc__title">Contents</h4>
                <ul class="toc__list">
                    {
                        sections.map((section) => (
                            <li class="toc__item">
                                <a
                                    href={`#section-${section.toLowerCase()}`}
                                    class="toc__link"
                                    data-toc-section={section}
                                >
                                    {section}
                                </a>
                            </li>
                        ))
                    }
                </ul>
            </nav>
        </aside>
    </div>

    <!-- Citation Hover Popover -->
    {
        doctor.citations && doctor.citations.length > 0 && (
            <CitationHover citations={doctor.citations} />
        )
    }

    <!-- Cite Popup (for text selection) -->
    <CitePopup doctorName={doctor.fullName} slug={slug} />
</Layout>

<style>
    /* ‚îÄ‚îÄ‚îÄ Scroll Offset for Sticky Header ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */

    [data-section] {
        scroll-margin-top: 100px;
    }

    /* ‚îÄ‚îÄ‚îÄ Aura Glow Effect ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */

    .profile-hero--aura {
        position: relative;
        overflow: hidden;
    }

    .profile-hero--aura::before {
        content: "";
        position: absolute;
        inset: -50%;
        background:
            radial-gradient(
                ellipse at 30% 50%,
                rgba(139, 92, 246, 0.08) 0%,
                transparent 60%
            ),
            radial-gradient(
                ellipse at 70% 50%,
                rgba(255, 215, 0, 0.06) 0%,
                transparent 60%
            );
        animation: auraRotate 20s linear infinite;
        z-index: 0;
        pointer-events: none;
    }

    .profile-hero--aura > .container {
        position: relative;
        z-index: 1;
    }

    @keyframes auraRotate {
        from {
            transform: rotate(0deg);
        }
        to {
            transform: rotate(360deg);
        }
    }

    /* ‚îÄ‚îÄ‚îÄ LEGACY Watermark ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */

    .profile-hero__legacy-watermark {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) rotate(-12deg);
        font-family: var(--font-serif);
        font-size: clamp(4rem, 12vw, 10rem);
        font-weight: 700;
        letter-spacing: 0.3em;
        color: rgba(255, 255, 255, 0.03);
        pointer-events: none;
        z-index: 0;
        white-space: nowrap;
        user-select: none;
    }

    .profile-hero {
        padding: var(--space-3xl) 0;
        margin-bottom: var(--space-xl);
        position: relative;
    }

    .profile-hero__content {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: var(--space-2xl);
    }

    .profile-hero__info {
        flex: 1;
    }

    .profile-hero__badges {
        display: flex;
        align-items: center;
        gap: var(--space-md);
    }

    .profile-hero__name {
        margin-top: var(--space-md);
        font-size: clamp(2rem, 5vw, 3rem);
        color: white;
    }

    .profile-hero__title {
        font-weight: 400;
        font-size: 0.6em;
        opacity: 0.75;
    }

    .profile-hero__specialty {
        font-size: 1.15rem;
        color: rgba(255, 255, 255, 0.7);
        margin-top: var(--space-sm);
        font-family: var(--font-sans);
    }

    .profile-hero__location {
        font-size: 0.9rem;
        color: rgba(255, 255, 255, 0.5);
        margin-top: var(--space-xs);
    }

    .profile-hero__dates {
        font-family: var(--font-mono);
        font-size: 0.85rem;
        color: rgba(255, 255, 255, 0.4);
        margin-top: var(--space-xs);
    }

    .profile-hero__stats {
        display: flex;
        gap: var(--space-xl);
        margin-top: var(--space-xl);
        padding-top: var(--space-lg);
        border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    .stat {
        text-align: center;
    }

    .stat__value {
        display: block;
        font-family: var(--font-serif);
        font-size: 1.75rem;
        font-weight: 700;
        color: white;
    }

    .stat__label {
        font-size: 0.7rem;
        color: rgba(255, 255, 255, 0.5);
        text-transform: uppercase;
        letter-spacing: 0.08em;
        font-weight: 600;
    }

    .profile-hero__portrait {
        flex-shrink: 0;
        position: relative;
        border-radius: var(--radius-lg);
        overflow: hidden;
        border: 3px solid rgba(255, 255, 255, 0.15);
    }

    .profile-hero__portrait img {
        display: block;
        width: 280px;
        height: 280px;
        object-fit: cover;
    }

    .profile-body {
        display: flex;
        gap: var(--space-2xl);
        padding: var(--space-xl) var(--space-lg);
        align-items: flex-start;
    }

    .profile-main {
        flex: 1;
        min-width: 0;
    }

    /* ‚îÄ‚îÄ‚îÄ Sticky Sidebar ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */

    .profile-sidebar {
        position: sticky;
        top: var(--space-xl);
        width: var(--sidebar-width);
        flex-shrink: 0;
        max-height: calc(100vh - var(--space-2xl));
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: var(--space-lg);
    }

    /* ‚îÄ‚îÄ‚îÄ Table of Contents ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */

    .toc {
        background: var(--bg-card);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-md);
        padding: var(--space-lg);
    }

    .toc__title {
        font-family: var(--font-sans);
        font-size: 0.75rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        color: var(--text-muted);
        margin-bottom: var(--space-md);
    }

    .toc__list {
        list-style: none;
        display: flex;
        flex-direction: column;
        gap: var(--space-xs);
    }

    .toc__link {
        display: block;
        padding: var(--space-xs) var(--space-sm);
        font-size: 0.85rem;
        color: var(--text-secondary);
        border-left: 2px solid transparent;
        transition: all var(--transition-fast);
        text-decoration: none;
    }

    .toc__link:hover {
        color: var(--text-primary);
        border-left-color: var(--accent-purple);
        background: rgba(139, 92, 246, 0.05);
    }

    .toc__link.active {
        color: var(--accent-purple);
        border-left-color: var(--accent-purple);
        background: rgba(139, 92, 246, 0.1);
        font-weight: 600;
    }

    /* ‚îÄ‚îÄ‚îÄ Profile Sections ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */

    .profile-section {
        margin-bottom: var(--space-2xl);
    }

    .profile-section h2 {
        margin-bottom: var(--space-md);
        padding-bottom: var(--space-sm);
        border-bottom: 1px solid var(--border-subtle);
        font-size: 1.5rem;
        color: var(--text-primary);
    }

    .profile-section__citations {
        margin-top: var(--space-sm);
    }

    .citation-link {
        font-family: var(--font-mono);
        font-size: 0.7em;
        color: var(--wiki-blue, #0056b3);
        font-weight: 600;
        text-decoration: none;
        transition: color var(--transition-fast);
    }

    .citation-link:hover {
        color: var(--accent-purple);
        text-decoration: underline;
    }

    .techniques-list {
        list-style: none;
        display: flex;
        flex-direction: column;
        gap: var(--space-sm);
    }

    .technique-item {
        display: flex;
        align-items: center;
        gap: var(--space-sm);
        padding: var(--space-sm) var(--space-md);
        background: var(--bg-card);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-md);
        font-weight: 500;
    }

    .technique-icon {
        font-size: 1.1em;
    }

    .awards-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: var(--space-md);
    }

    .award-card {
        background: var(--bg-card);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-md);
        padding: var(--space-lg);
        transition: all var(--transition-base);
    }

    .award-card:hover {
        border-color: var(--titan-border);
        transform: translateY(-2px);
    }

    .award-year {
        font-family: var(--font-mono);
        font-size: 0.75rem;
        color: var(--accent-purple);
        font-weight: 600;
    }

    .award-name {
        font-family: var(--font-sans);
        font-size: 1rem;
        font-weight: 600;
        margin: var(--space-xs) 0;
        color: var(--text-primary);
    }

    .award-body {
        font-size: 0.8rem;
        color: var(--text-muted);
    }

    @media (max-width: 768px) {
        .profile-hero__content {
            flex-direction: column-reverse;
            align-items: center;
            text-align: center;
        }

        .profile-hero__badges {
            justify-content: center;
        }

        .profile-hero__stats {
            flex-wrap: wrap;
            justify-content: center;
        }

        .profile-hero__portrait img {
            width: 180px;
            height: 180px;
        }

        .profile-body {
            flex-direction: column;
        }

        .profile-sidebar {
            position: static;
            width: 100%;
            max-height: none;
        }
    }
</style>

<script>
    // Intersection Observer for auto-highlighting sidebar TOC
    document.addEventListener("DOMContentLoaded", () => {
        const tocLinks = document.querySelectorAll(".toc__link");
        const sections = document.querySelectorAll("[data-section]");

        if (sections.length === 0 || tocLinks.length === 0) return;

        const observer = new IntersectionObserver(
            (entries) => {
                entries.forEach((entry) => {
                    if (entry.isIntersecting) {
                        const sectionName = (entry.target as HTMLElement)
                            .dataset.section;
                        tocLinks.forEach((link) => {
                            link.classList.toggle(
                                "active",
                                link.getAttribute("data-toc-section") ===
                                    sectionName,
                            );
                        });
                    }
                });
            },
            {
                rootMargin: "-20% 0px -60% 0px",
                threshold: 0,
            },
        );

        sections.forEach((section) => observer.observe(section));
    });
</script>
