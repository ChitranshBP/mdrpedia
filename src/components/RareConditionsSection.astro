---
/**
 * MDRPedia â€” Rare Conditions Section
 * Enhanced display of rare conditions this surgeon specializes in treating
 * Includes categorization, visual hierarchy, and educational context
 */

interface Props {
    conditions: string[];
    specialty: string;
    doctorName: string;
    className?: string;
}

const { conditions, specialty, doctorName, className = "" } = Astro.props;

// Don't render if no conditions
if (!conditions || conditions.length === 0) {
    return null;
}

// Categorize conditions by type (simple heuristic based on common patterns)
interface ConditionCategory {
    name: string;
    icon: string;
    color: string;
    conditions: string[];
}

function categorizeConditions(
    conditions: string[],
    specialty: string,
): ConditionCategory[] {
    const categories: Record<string, ConditionCategory> = {
        congenital: {
            name: "Congenital",
            icon: "ðŸ§’",
            color: "blue",
            conditions: [],
        },
        tumor: {
            name: "Tumors & Cancer",
            icon: "ðŸ”¬",
            color: "purple",
            conditions: [],
        },
        vascular: {
            name: "Vascular",
            icon: "â¤ï¸",
            color: "red",
            conditions: [],
        },
        degenerative: {
            name: "Degenerative",
            icon: "âš™ï¸",
            color: "amber",
            conditions: [],
        },
        trauma: {
            name: "Trauma & Injury",
            icon: "ðŸ©¹",
            color: "orange",
            conditions: [],
        },
        inflammatory: {
            name: "Inflammatory",
            icon: "ðŸ”¥",
            color: "rose",
            conditions: [],
        },
        other: {
            name: "Specialized",
            icon: "â­",
            color: "emerald",
            conditions: [],
        },
    };

    const congenitalKeywords = [
        "congenital",
        "birth",
        "pediatric",
        "neonatal",
        "atresia",
        "hypoplasia",
        "malformation",
    ];
    const tumorKeywords = [
        "tumor",
        "cancer",
        "carcinoma",
        "sarcoma",
        "neoplasm",
        "malignant",
        "oncology",
        "mass",
    ];
    const vascularKeywords = [
        "vascular",
        "aneurysm",
        "artery",
        "vein",
        "stenosis",
        "occlusion",
        "thrombo",
        "embol",
    ];
    const degenerativeKeywords = [
        "degenerative",
        "arthritis",
        "osteo",
        "disc",
        "wear",
        "aging",
    ];
    const traumaKeywords = [
        "trauma",
        "fracture",
        "injury",
        "wound",
        "rupture",
        "tear",
        "dislocation",
    ];
    const inflammatoryKeywords = [
        "inflammation",
        "inflammatory",
        "itis",
        "autoimmune",
        "crohn",
        "colitis",
    ];

    for (const condition of conditions) {
        const lower = condition.toLowerCase();

        if (congenitalKeywords.some((k) => lower.includes(k))) {
            categories.congenital.conditions.push(condition);
        } else if (tumorKeywords.some((k) => lower.includes(k))) {
            categories.tumor.conditions.push(condition);
        } else if (vascularKeywords.some((k) => lower.includes(k))) {
            categories.vascular.conditions.push(condition);
        } else if (degenerativeKeywords.some((k) => lower.includes(k))) {
            categories.degenerative.conditions.push(condition);
        } else if (traumaKeywords.some((k) => lower.includes(k))) {
            categories.trauma.conditions.push(condition);
        } else if (inflammatoryKeywords.some((k) => lower.includes(k))) {
            categories.inflammatory.conditions.push(condition);
        } else {
            categories.other.conditions.push(condition);
        }
    }

    // Return only categories that have conditions
    return Object.values(categories).filter((cat) => cat.conditions.length > 0);
}

const categorizedConditions = categorizeConditions(conditions, specialty);
const totalConditions = conditions.length;

// Rarity indicator based on count
function getRarityLevel(count: number): { label: string; class: string } {
    if (count >= 10)
        return { label: "Highly Specialized", class: "rarity-high" };
    if (count >= 5) return { label: "Specialized", class: "rarity-medium" };
    return { label: "Select Conditions", class: "rarity-low" };
}

const rarityInfo = getRarityLevel(totalConditions);
---

<section
    class={`rare-conditions-section ${className}`}
    id="section-rare-conditions"
    data-section="Rare Conditions"
>
    <div class="section-header">
        <div class="header-left">
            <h2>
                <svg
                    class="header-icon"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                >
                    <path
                        d="M19.5 12.572l-7.5 7.428-7.5-7.428A5 5 0 1112 5.006a5 5 0 017.5 7.566z"
                    ></path>
                </svg>
                Rare Conditions Expertise
            </h2>
            <span class={`rarity-badge ${rarityInfo.class}`}>
                {rarityInfo.label}
            </span>
        </div>
        <div class="condition-count">
            <span class="count-number">{totalConditions}</span>
            <span class="count-label">Documented Conditions</span>
        </div>
    </div>

    <div class="section-intro">
        <p>
            <strong>{doctorName}</strong> has documented expertise in treating the
            following rare or complex conditions within <strong
                >{specialty}</strong
            >. These conditions often require highly specialized surgical skills
            and experience that few practitioners possess.
        </p>
    </div>

    {/* Categorized Display */}
    {
        categorizedConditions.length > 1 ? (
            <div class="conditions-categorized">
                {categorizedConditions.map((category) => (
                    <div
                        class={`condition-category category-${category.color}`}
                    >
                        <div class="category-header">
                            <span class="category-icon">{category.icon}</span>
                            <span class="category-name">{category.name}</span>
                            <span class="category-count">
                                {category.conditions.length}
                            </span>
                        </div>
                        <ul class="category-conditions">
                            {category.conditions.map((condition) => (
                                <li class="condition-item">
                                    <span class="condition-dot" />
                                    <a
                                        href={`/search?q=${encodeURIComponent(condition)}`}
                                        class="condition-name"
                                        style="text-decoration: none; color: inherit; transition: opacity 0.2s;"
                                        onmouseover="this.style.opacity=0.8"
                                        onmouseout="this.style.opacity=1"
                                    >
                                        {condition}
                                    </a>
                                </li>
                            ))}
                        </ul>
                    </div>
                ))}
            </div>
        ) : (
            <ul class="conditions-flat">
                {conditions.map((condition) => (
                    <li class="condition-item">
                        <span class="condition-dot" />
                        <a
                            href={`/search?q=${encodeURIComponent(condition)}`}
                            class="condition-name"
                            style="text-decoration: none; color: inherit; transition: opacity 0.2s;"
                            onmouseover="this.style.opacity=0.8"
                            onmouseout="this.style.opacity=1"
                        >
                            {condition}
                        </a>
                    </li>
                ))}
            </ul>
        )
    }

    {/* Educational Note */}
    <div class="educational-note">
        <svg
            class="note-icon"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
        >
            <circle cx="12" cy="12" r="10"></circle>
            <path d="M12 16v-4M12 8h.01"></path>
        </svg>
        <div class="note-content">
            <strong>What makes a condition "rare"?</strong>
            <p>
                Rare diseases typically affect fewer than 200,000 people in the
                US or fewer than 1 in 2,000 in Europe. Surgeons specializing in
                rare conditions often serve as referral experts for complex
                cases that general practitioners may encounter only once in
                their careers.
            </p>
        </div>
    </div>

    {/* CTA for patients */}
    <div class="patient-cta">
        <p>
            If you have one of these conditions and are seeking specialized
            care,
            <a href={`/contact?subject=rare-condition&doctor=${doctorName}`}
                >contact us for a referral inquiry</a
            >.
        </p>
    </div>
</section>

<style>
    .rare-conditions-section {
        background: linear-gradient(
            135deg,
            rgba(16, 185, 129, 0.05) 0%,
            rgba(6, 95, 70, 0.08) 100%
        );
        border: 1px solid rgba(16, 185, 129, 0.15);
        border-radius: 16px;
        padding: 28px;
        margin-bottom: 32px;
    }

    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 20px;
        flex-wrap: wrap;
        gap: 16px;
    }

    .header-left {
        display: flex;
        align-items: center;
        gap: 12px;
        flex-wrap: wrap;
    }

    .section-header h2 {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--text-primary);
        margin: 0;
        border: none;
        padding: 0;
    }

    .header-icon {
        width: 24px;
        height: 24px;
        color: #10b981;
    }

    .rarity-badge {
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.7rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    .rarity-high {
        background: rgba(16, 185, 129, 0.2);
        color: #34d399;
        border: 1px solid rgba(16, 185, 129, 0.3);
    }

    .rarity-medium {
        background: rgba(59, 130, 246, 0.2);
        color: #60a5fa;
        border: 1px solid rgba(59, 130, 246, 0.3);
    }

    .rarity-low {
        background: rgba(139, 92, 246, 0.2);
        color: #a78bfa;
        border: 1px solid rgba(139, 92, 246, 0.3);
    }

    .condition-count {
        text-align: right;
    }

    .count-number {
        display: block;
        font-size: 2rem;
        font-weight: 700;
        color: #10b981;
        line-height: 1;
        font-family: var(--font-mono);
    }

    .count-label {
        font-size: 0.7rem;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    .section-intro {
        margin-bottom: 24px;
        padding-bottom: 20px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    .section-intro p {
        font-size: 0.95rem;
        color: var(--text-secondary);
        line-height: 1.6;
        margin: 0;
    }

    .section-intro strong {
        color: var(--text-primary);
    }

    /* Categorized Layout */
    .conditions-categorized {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
        margin-bottom: 24px;
    }

    .condition-category {
        background: rgba(255, 255, 255, 0.02);
        border-radius: 12px;
        padding: 16px;
        border: 1px solid rgba(255, 255, 255, 0.05);
    }

    .category-header {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 12px;
        padding-bottom: 8px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    .category-icon {
        font-size: 1.2rem;
    }

    .category-name {
        flex: 1;
        font-weight: 600;
        font-size: 0.9rem;
        color: var(--text-primary);
    }

    .category-count {
        background: rgba(255, 255, 255, 0.1);
        padding: 2px 8px;
        border-radius: 10px;
        font-size: 0.7rem;
        font-weight: 600;
        color: var(--text-muted);
    }

    .category-conditions,
    .conditions-flat {
        list-style: none;
        padding: 0;
        margin: 0;
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .condition-item {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 8px 12px;
        background: rgba(255, 255, 255, 0.02);
        border-radius: 8px;
        transition: all 0.2s;
    }

    .condition-item:hover {
        background: rgba(255, 255, 255, 0.05);
        transform: translateX(4px);
    }

    .condition-dot {
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: #10b981;
        flex-shrink: 0;
    }

    .condition-name {
        font-size: 0.9rem;
        color: var(--text-secondary);
    }

    /* Category color variants */
    .category-blue .condition-dot {
        background: #3b82f6;
    }
    .category-purple .condition-dot {
        background: #8b5cf6;
    }
    .category-red .condition-dot {
        background: #ef4444;
    }
    .category-amber .condition-dot {
        background: #f59e0b;
    }
    .category-orange .condition-dot {
        background: #f97316;
    }
    .category-rose .condition-dot {
        background: #f43f5e;
    }
    .category-emerald .condition-dot {
        background: #10b981;
    }

    /* Flat Layout (when only one category) */
    .conditions-flat {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 10px;
        margin-bottom: 24px;
    }

    /* Educational Note */
    .educational-note {
        display: flex;
        gap: 12px;
        background: rgba(255, 255, 255, 0.02);
        border: 1px solid rgba(255, 255, 255, 0.05);
        border-radius: 10px;
        padding: 16px;
        margin-bottom: 16px;
    }

    .note-icon {
        width: 20px;
        height: 20px;
        color: var(--text-muted);
        flex-shrink: 0;
        margin-top: 2px;
    }

    .note-content strong {
        display: block;
        font-size: 0.85rem;
        color: var(--text-primary);
        margin-bottom: 4px;
    }

    .note-content p {
        font-size: 0.8rem;
        color: var(--text-muted);
        line-height: 1.5;
        margin: 0;
    }

    /* Patient CTA */
    .patient-cta {
        text-align: center;
        padding-top: 12px;
        border-top: 1px solid rgba(255, 255, 255, 0.05);
    }

    .patient-cta p {
        font-size: 0.85rem;
        color: var(--text-muted);
        margin: 0;
    }

    .patient-cta a {
        color: #10b981;
        text-decoration: none;
        font-weight: 500;
    }

    .patient-cta a:hover {
        text-decoration: underline;
    }

    @media (max-width: 640px) {
        .rare-conditions-section {
            padding: 20px;
        }

        .section-header {
            flex-direction: column;
        }

        .condition-count {
            text-align: left;
        }

        .conditions-categorized {
            grid-template-columns: 1fr;
        }

        .conditions-flat {
            grid-template-columns: 1fr;
        }
    }
</style>
