---
/**
 * MDRPedia â€” Homepage
 * Search-first design with live feed of recently verified doctors
 */

import Layout from "../layouts/Layout.astro";
import Search from "../components/Search.astro"; // Pagefind Search
import TierBadge from "../components/TierBadge.astro";
import { getCollection } from "astro:content";

const allDoctors = await getCollection("doctors");
const recentDoctors = allDoctors
	.sort((a, b) => {
		// Sort by modification time (approximated here by reverse list order for now,
		// as file system stats aren't exposed in content collection)
		// Or better: sort by tier for quality
		const tierOrder = { TITAN: 0, ELITE: 1, MASTER: 2, UNRANKED: 3 };
		return (tierOrder[a.data.tier] ?? 3) - (tierOrder[b.data.tier] ?? 3);
	})
	.slice(0, 5);
---

<Layout
	title="MDRPedia â€” The Global Single-Source of Truth for Doctors & Surgeons"
>
	<!-- Hero Section -->
	<section class="hero">
		<div class="hero__bg-effects">
			<div class="hero__orb hero__orb--1"></div>
			<div class="hero__orb hero__orb--2"></div>
			<div class="hero__orb hero__orb--3"></div>
		</div>

		<div class="container hero__content">
			<div class="hero__badge">
				<span>ğŸ›ï¸ The Gold Standard</span>
			</div>
			<h1 class="hero__title">
				The World's Most Trusted
				<br />
				<span class="hero__gradient-text"
					>Medical Professional Directory</span
				>
			</h1>
			<p class="hero__subtitle">
				Every profile is DOI-verified. Every citation is
				cross-referenced.
				<br />
				The single-source of truth for 100,000+ doctors and surgeons.
			</p>

			<div class="hero__search-wrapper">
				<Search />
			</div>

			<div class="hero__trust-bar">
				<div class="trust-item">
					<span class="trust-number">100K+</span>
					<span class="trust-label">Verified Profiles</span>
				</div>
				<div class="trust-divider"></div>
				<div class="trust-item">
					<span class="trust-number">2M+</span>
					<span class="trust-label">DOI-Verified Citations</span>
				</div>
				<div class="trust-divider"></div>
				<div class="trust-item">
					<span class="trust-number">195</span>
					<span class="trust-label">Countries</span>
				</div>
			</div>
		</div>
	</section>

	<!-- Tier Explanation -->
	<section class="tiers-section">
		<div class="container">
			<h2 class="section-title">The MDR Tier System</h2>
			<p class="section-subtitle">
				Ranked by peer-reviewed impact, not popularity
			</p>

			<div class="tiers-grid">
				<div class="tier-card tier-card--titan">
					<div class="tier-card__header">
						<span class="tier-card__emoji">ğŸ†</span>
						<h3>Titan</h3>
						<span class="tier-card__pct">Top 0.01%</span>
					</div>
					<p>
						Paradigm shifters. Invented techniques named after them.
						H-index &gt; 60 or 20,000+ verified lives saved.
					</p>
					<div class="tier-card__req">
						Requires 3 peer verifications
					</div>
				</div>

				<div class="tier-card tier-card--elite">
					<div class="tier-card__header">
						<span class="tier-card__emoji">ğŸ¥ˆ</span>
						<h3>Elite</h3>
						<span class="tier-card__pct">Top 1%</span>
					</div>
					<p>
						National/International authorities. Department heads at
						Top 50 hospitals. 100+ peer-reviewed publications.
					</p>
					<div class="tier-card__req">
						Automated license verification
					</div>
				</div>

				<div class="tier-card tier-card--master">
					<div class="tier-card__header">
						<span class="tier-card__emoji">ğŸ¥‰</span>
						<h3>Master</h3>
						<span class="tier-card__pct">Top 3%</span>
					</div>
					<p>
						Regional mastery. Top-rated in specialty and geography.
						15+ years of consistent clinical excellence.
					</p>
					<div class="tier-card__req">Peer recognition required</div>
				</div>
			</div>
		</div>
	</section>

	<!-- Recently Verified Feed -->
	<section class="feed-section">
		<div class="container">
			<h2 class="section-title">Recently Verified</h2>
			<p class="section-subtitle">
				Latest profiles added to the MDRPedia registry
			</p>

			<div class="feed-grid">
				{
					recentDoctors.map((doctor) => {
						const d = doctor.data;
						const location = [
							d.geography.city,
							d.geography.region,
							d.geography.country,
						]
							.filter(Boolean)
							.join(", ");

						return (
							<a
								href={`/doctors/${doctor.id}`}
								class={`feed-card card card--${d.tier.toLowerCase()}`}
							>
								<div class="feed-card__header">
									<TierBadge
										tier={
											d.tier as
												| "TITAN"
												| "ELITE"
												| "MASTER"
												| "UNRANKED"
										}
										size="sm"
									/>
									{d.status === "HISTORICAL" && (
										<span class="feed-card__legacy">
											Legacy
										</span>
									)}
								</div>
								<h3 class="feed-card__name">{d.fullName}</h3>
								<p class="feed-card__specialty">
									{d.specialty}
								</p>
								<p class="feed-card__location">ğŸ“ {location}</p>
								<div class="feed-card__stats">
									<span>H-index: {d.hIndex}</span>
									<span>Â·</span>
									<span>
										{d.citations ? d.citations.length : 0}{" "}
										citations
									</span>
								</div>
							</a>
						);
					})
				}
			</div>
		</div>
	</section>
</Layout>

<style>
	/* â”€â”€â”€ Hero â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
	.hero {
		position: relative;
		padding: var(--space-3xl) 0 calc(var(--space-3xl) * 1.5);
		text-align: center;
		overflow: hidden;
	}

	.hero__bg-effects {
		position: absolute;
		inset: 0;
		pointer-events: none;
		overflow: hidden;
	}

	.hero__orb {
		position: absolute;
		border-radius: 50%;
		filter: blur(80px);
		opacity: 0.15;
	}

	.hero__orb--1 {
		width: 500px;
		height: 500px;
		background: var(--accent-purple);
		top: -200px;
		left: -100px;
	}

	.hero__orb--2 {
		width: 400px;
		height: 400px;
		background: var(--accent-blue);
		bottom: -150px;
		right: -100px;
	}

	.hero__orb--3 {
		width: 300px;
		height: 300px;
		background: var(--titan-border);
		top: 50%;
		left: 50%;
		transform: translate(-50%, -50%);
		opacity: 0.05;
	}

	.hero__content {
		position: relative;
		z-index: 1;
	}

	.hero__badge {
		display: inline-flex;
		align-items: center;
		gap: var(--space-sm);
		padding: var(--space-xs) var(--space-lg);
		background: rgba(139, 92, 246, 0.1);
		border: 1px solid rgba(139, 92, 246, 0.2);
		border-radius: var(--radius-full);
		font-size: 0.85rem;
		color: var(--accent-purple);
		font-weight: 600;
		margin-bottom: var(--space-xl);
	}

	.hero__title {
		font-size: clamp(2.5rem, 6vw, 4rem);
		line-height: 1.1;
		margin-bottom: var(--space-lg);
	}

	.hero__gradient-text {
		background: linear-gradient(
			135deg,
			var(--accent-purple),
			var(--accent-blue),
			var(--accent-emerald)
		);
		-webkit-background-clip: text;
		-webkit-text-fill-color: transparent;
		background-clip: text;
	}

	.hero__subtitle {
		font-size: 1.1rem;
		color: var(--text-secondary);
		max-width: 580px;
		margin: 0 auto var(--space-2xl);
		line-height: 1.8;
	}

	.hero__search {
		margin-bottom: var(--space-2xl);
	}

	.hero__trust-bar {
		display: flex;
		justify-content: center;
		align-items: center;
		gap: var(--space-xl);
		flex-wrap: wrap;
	}

	.trust-item {
		display: flex;
		flex-direction: column;
		align-items: center;
		gap: 2px;
	}

	.trust-number {
		font-family: var(--font-serif);
		font-size: 1.75rem;
		font-weight: 800;
		color: var(--text-primary);
	}

	.trust-label {
		font-size: 0.75rem;
		color: var(--text-muted);
		text-transform: uppercase;
		letter-spacing: 0.08em;
		font-weight: 600;
	}

	.trust-divider {
		width: 1px;
		height: 40px;
		background: var(--border-subtle);
	}

	/* â”€â”€â”€ Tiers Section â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
	.tiers-section {
		padding: var(--space-3xl) 0;
	}

	.section-title {
		text-align: center;
		margin-bottom: var(--space-xs);
	}

	.section-subtitle {
		text-align: center;
		color: var(--text-muted);
		font-size: 0.95rem;
		margin-bottom: var(--space-2xl);
	}

	.tiers-grid {
		display: grid;
		grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
		gap: var(--space-lg);
	}

	.tier-card {
		padding: var(--space-xl);
		border-radius: var(--radius-lg);
		border: 1px solid var(--border-subtle);
		background: var(--bg-card);
		transition: all var(--transition-base);
	}

	.tier-card:hover {
		transform: translateY(-4px);
	}

	.tier-card--titan {
		border-color: var(--titan-border);
		box-shadow: var(--shadow-glow-titan);
	}
	.tier-card--elite {
		border-color: var(--elite-border);
		box-shadow: var(--shadow-glow-elite);
	}
	.tier-card--master {
		border-color: var(--master-border);
		box-shadow: var(--shadow-glow-master);
	}

	.tier-card__header {
		display: flex;
		align-items: center;
		gap: var(--space-sm);
		margin-bottom: var(--space-md);
	}

	.tier-card__emoji {
		font-size: 1.5rem;
	}

	.tier-card__header h3 {
		font-family: var(--font-sans);
		font-size: 1.25rem;
		flex: 1;
	}

	.tier-card__pct {
		font-family: var(--font-mono);
		font-size: 0.75rem;
		font-weight: 600;
		padding: 2px 8px;
		border-radius: var(--radius-full);
		background: var(--bg-elevated);
		color: var(--text-secondary);
	}

	.tier-card p {
		font-size: 0.9rem;
		color: var(--text-secondary);
		line-height: 1.6;
	}

	.tier-card__req {
		margin-top: var(--space-md);
		font-size: 0.75rem;
		color: var(--text-muted);
		padding-top: var(--space-sm);
		border-top: 1px solid var(--border-subtle);
	}

	/* â”€â”€â”€ Feed Section â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
	.feed-section {
		padding: var(--space-3xl) 0;
	}

	.feed-grid {
		display: grid;
		grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
		gap: var(--space-lg);
	}

	.feed-card {
		text-decoration: none;
		display: flex;
		flex-direction: column;
		gap: var(--space-sm);
	}

	.feed-card__header {
		display: flex;
		justify-content: space-between;
		align-items: center;
	}

	.feed-card__legacy {
		font-size: 0.7rem;
		color: var(--text-muted);
		font-style: italic;
		padding: 2px 8px;
		background: rgba(255, 255, 255, 0.05);
		border-radius: var(--radius-full);
	}

	.feed-card__name {
		font-family: var(--font-serif);
		font-size: 1.25rem;
		color: var(--text-primary);
	}

	.feed-card__specialty {
		font-size: 0.9rem;
		color: var(--text-secondary);
	}

	.feed-card__location {
		font-size: 0.8rem;
		color: var(--text-muted);
	}

	.feed-card__stats {
		display: flex;
		gap: var(--space-sm);
		font-family: var(--font-mono);
		font-size: 0.75rem;
		color: var(--text-muted);
		margin-top: auto;
		padding-top: var(--space-sm);
		border-top: 1px solid var(--border-subtle);
	}
</style>
