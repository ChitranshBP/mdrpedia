---
/**
 * MDRPedia — Browse All Doctors
 * Searchable grid of all verified doctor profiles
 * Database-first with static fallback
 */
import Layout from "../../layouts/Layout.astro";
import TierBadge from "../../components/TierBadge.astro";
import OptimizedImage from "../../components/OptimizedImage.astro";
import EnhancedSearch from "../../components/EnhancedSearch";
import { getCollection } from "astro:content";
import { prisma } from "../../lib/prisma";

export const prerender = false;

// Sort order for tiers
const tierOrder: Record<string, number> = {
    TITAN: 0,
    ELITE: 1,
    MASTER: 2,
    UNRANKED: 3,
};

// Unified doctor type for UI
type DoctorItem = {
    slug: string;
    fullName: string;
    title: string | null;
    specialty: string;
    tier: string;
    status: string;
    rankingScore: number | null;
    hIndex: number;
    portraitUrl: string | null;
    geography: { country: string; city?: string | null };
    livesSaved: number;
    citations: number;
};

let sortedDoctors: DoctorItem[] = [];
let countries: string[] = [];
let specialties: string[] = [];
let dataSource = 'database';

try {
    // Fetch from database
    const dbDoctors = await prisma.profile.findMany({
        select: {
            slug: true,
            full_name: true,
            title: true,
            specialty: true,
            tier: true,
            status: true,
            ranking_score: true,
            h_index: true,
            portrait_url: true,
            geography: {
                select: {
                    country: true,
                    city: true
                }
            },
            impact_metrics: {
                select: {
                    lives_saved: true
                }
            },
            _count: {
                select: {
                    citations: true
                }
            }
        },
        orderBy: [
            { tier: 'asc' }, // TITAN comes first alphabetically
            { ranking_score: 'desc' },
            { h_index: 'desc' }
        ]
    });

    if (dbDoctors.length > 0) {
        sortedDoctors = dbDoctors.map(d => ({
            slug: d.slug,
            fullName: d.full_name,
            title: d.title,
            specialty: d.specialty,
            tier: d.tier,
            status: d.status,
            rankingScore: d.ranking_score,
            hIndex: d.h_index,
            portraitUrl: d.portrait_url,
            geography: d.geography || { country: 'Unknown' },
            livesSaved: d.impact_metrics?.lives_saved || 0,
            citations: d._count?.citations || 0
        }));

        // Sort properly by tier order
        sortedDoctors.sort((a, b) => {
            const tierDiff = (tierOrder[a.tier] ?? 3) - (tierOrder[b.tier] ?? 3);
            if (tierDiff !== 0) return tierDiff;
            const rankA = a.rankingScore ?? 0;
            const rankB = b.rankingScore ?? 0;
            if (rankB !== rankA) return rankB - rankA;
            return b.hIndex - a.hIndex;
        });

        // Extract unique countries and specialties
        countries = Array.from(new Set(sortedDoctors.map(d => d.geography.country).filter(Boolean))).sort();
        specialties = Array.from(new Set(sortedDoctors.map(d => d.specialty).filter(Boolean))).sort();
    } else {
        throw new Error('No profiles in database');
    }
} catch (e) {
    // Fallback to static content
    dataSource = 'static';
    console.log('Doctors page falling back to static content:', e);
    const allDoctors = await getCollection("doctors");

    sortedDoctors = allDoctors.map(d => ({
        slug: d.id,
        fullName: d.data.fullName,
        title: d.data.title || null,
        specialty: d.data.specialty,
        tier: d.data.tier || 'UNRANKED',
        status: d.data.status || 'LIVING',
        rankingScore: d.data.rankingScore || null,
        hIndex: d.data.hIndex || 0,
        portraitUrl: d.data.portraitUrl || null,
        geography: d.data.geography,
        livesSaved: d.data.livesSaved || 0,
        citations: d.data.citations || 0
    }));

    sortedDoctors.sort((a, b) => {
        const tierDiff = (tierOrder[a.tier] ?? 3) - (tierOrder[b.tier] ?? 3);
        if (tierDiff !== 0) return tierDiff;
        const rankA = a.rankingScore ?? 0;
        const rankB = b.rankingScore ?? 0;
        if (rankB !== rankA) return rankB - rankA;
        return b.hIndex - a.hIndex;
    });

    countries = Array.from(new Set(sortedDoctors.map(d => d.geography.country).filter(Boolean))).sort();
    specialties = Array.from(new Set(sortedDoctors.map(d => d.specialty).filter(Boolean))).sort();
}

// Stats
const titanCount = sortedDoctors.filter(d => d.tier === "TITAN").length;
const eliteCount = sortedDoctors.filter(d => d.tier === "ELITE").length;
const masterCount = sortedDoctors.filter(d => d.tier === "MASTER").length;
---

<Layout title="Browse All Doctors — MDRPedia">
    <section class="browse">
        <div class="container">
            <!-- Header -->
            <div class="browse-header">
                <div class="browse-header__text">
                    <h1>Browse Profiles</h1>
                    <p>{sortedDoctors.length} verified medical professionals</p>
                </div>
                <div class="browse-header__stats">
                    <span class="mini-stat mini-stat--titan"
                        >{titanCount} Titans</span
                    >
                    <span class="mini-stat mini-stat--elite"
                        >{eliteCount} Elite</span
                    >
                    <span class="mini-stat mini-stat--master"
                        >{masterCount} Master</span
                    >
                </div>
            </div>

            <!-- Search & Filters -->
            <div class="browse-controls">
                <div class="search-wrap search-wrap--enhanced">
                    <EnhancedSearch
                        client:load
                        placeholder="Quick search across all profiles..."
                        maxResults={6}
                    />
                </div>

                <!-- Grid Filter Input -->
                <div class="filter-input-wrap">
                    <svg
                        class="filter-icon"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                    >
                        <path d="M3 4h18M6 8h12M9 12h6M12 16h0"></path>
                    </svg>
                    <input
                        type="text"
                        id="browse-search"
                        class="filter-input"
                        placeholder="Filter visible results..."
                        autocomplete="off"
                    />
                </div>

                <!-- Role Filter -->
                <div class="filter-group">
                    <span class="filter-label">Role</span>
                    <div class="filter-buttons">
                        <button
                            class="filter-btn filter-btn--active"
                            data-group="role"
                            data-filter="all">All</button
                        >
                        <button
                            class="filter-btn"
                            data-group="role"
                            data-filter="surgeon">Surgeon</button
                        >
                        <button
                            class="filter-btn"
                            data-group="role"
                            data-filter="physician">Physician</button
                        >
                        <button
                            class="filter-btn"
                            data-group="role"
                            data-filter="researcher">Researcher</button
                        >
                    </div>
                </div>

                <div class="filter-group">
                    <span class="filter-label">Tier</span>
                    <div class="filter-buttons">
                        <button
                            class="filter-btn filter-btn--active"
                            data-group="tier"
                            data-filter="all">All</button
                        >
                        <button
                            class="filter-btn filter-btn--titan"
                            data-group="tier"
                            data-filter="TITAN">Titan</button
                        >
                        <button
                            class="filter-btn filter-btn--elite"
                            data-group="tier"
                            data-filter="ELITE">Elite</button
                        >
                    </div>
                </div>

                <!-- Country Filter -->
                <div class="filter-group">
                    <span class="filter-label">Country</span>
                    <select id="country-filter" class="filter-select">
                        <option value="all">All Countries</option>
                        {
                            countries.map((country) => (
                                <option value={country}>{country}</option>
                            ))
                        }
                    </select>
                </div>

                <!-- Specialty Filter -->
                <div class="filter-group">
                    <span class="filter-label">Specialty</span>
                    <select id="specialty-filter" class="filter-select">
                        <option value="all">All Specialties</option>
                        {
                            specialties.map((specialty) => (
                                <option value={specialty}>{specialty}</option>
                            ))
                        }
                    </select>
                </div>
            </div>

            <!-- Results Count -->
            <div class="results-info" id="results-info">
                Showing all {sortedDoctors.length} profiles
            </div>

            <!-- Doctor Grid -->
            <div class="browse-grid" id="doctor-grid">
                {
                    sortedDoctors.map((d) => {
                        const location = [
                            d.geography.city,
                            d.geography.country,
                        ]
                            .filter(Boolean)
                            .join(", ");
                        const initials = d.fullName
                            .split(" ")
                            .map((w: string) => w[0])
                            .filter((_: string, i: number) => i < 2)
                            .join("")
                            .toUpperCase();
                        const hasImage =
                            d.portraitUrl && !d.portraitUrl.startsWith("data:");

                        // Derive Role
                        const isSurgeon =
                            d.specialty.toLowerCase().includes("surgery") ||
                            d.specialty.toLowerCase().includes("surgeon") ||
                            d.specialty.toLowerCase().includes("transplant");
                        const isResearcher =
                            d.hIndex > 50 || d.title?.includes("PhD") || false; // Simple heuristic for now
                        const role = isSurgeon
                            ? "surgeon"
                            : isResearcher
                              ? "researcher"
                              : "physician";

                        return (
                            <a
                                href={`/doctors/${d.slug}`}
                                class={`doctor-card doctor-card--${d.tier.toLowerCase()}`}
                                data-tier={d.tier}
                                data-role={role}
                                data-country={d.geography.country}
                                data-name={d.fullName.toLowerCase()}
                                data-specialty={(
                                    d.specialty || ""
                                ).toLowerCase()}
                                data-location={location.toLowerCase()}
                            >
                                <div class="doctor-card__header">
                                    <div
                                        class={`doctor-card__avatar avatar--${d.tier.toLowerCase()}`}
                                    >
                                        <OptimizedImage
                                            src={d.portraitUrl}
                                            alt={d.fullName}
                                            width={64}
                                            height={64}
                                            fallbackInitials={initials}
                                            tier={d.tier as "TITAN" | "ELITE" | "MASTER" | "UNRANKED"}
                                        />
                                    </div>
                                    <div class="doctor-card__badges">
                                        <TierBadge
                                            tier={
                                                d.tier as
                                                    | "TITAN"
                                                    | "ELITE"
                                                    | "MASTER"
                                                    | "UNRANKED"
                                            }
                                            size="sm"
                                        />
                                        {d.status === "HISTORICAL" && (
                                            <span class="legacy-badge">
                                                Legacy
                                            </span>
                                        )}
                                    </div>
                                </div>
                                <h3 class="doctor-card__name">{d.fullName}</h3>
                                <p class="doctor-card__specialty">
                                    {d.specialty}
                                </p>
                                {location && (
                                    <p class="doctor-card__location">
                                        {location}
                                    </p>
                                )}
                                <div class="doctor-card__stats">
                                    <span class="stat">
                                        <strong>{d.hIndex || "-"}</strong>{" "}
                                        H-index
                                    </span>
                                    <span class="stat">
                                        <strong>
                                            {d.citations > 0 ? d.citations.toLocaleString() : "-"}
                                        </strong>{" "}
                                        citations
                                    </span>
                                </div>
                            </a>
                        );
                    })
                }
            </div>

            <!-- Empty State -->
            <div class="empty-state" id="empty-state" hidden>
                <svg
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="1.5"
                    width="48"
                    height="48"
                >
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="m21 21-4.3-4.3"></path>
                </svg>
                <h3>No results found</h3>
                <p>Try adjusting your search or filters</p>
            </div>
        </div>
    </section>
</Layout>

<script>
    // DOM Elements
    const buttons = document.querySelectorAll<HTMLButtonElement>(".filter-btn");
    const countrySelect = document.getElementById("country-filter") as HTMLSelectElement;
    const specialtySelect = document.getElementById("specialty-filter") as HTMLSelectElement;
    const cards = document.querySelectorAll<HTMLElement>(".doctor-card");
    const searchInput = document.getElementById("browse-search") as HTMLInputElement;
    const resultsInfo = document.getElementById("results-info");
    const emptyState = document.getElementById("empty-state");

    // Filter state
    let currentTier = "all";
    let currentStatus = "all";
    let currentRole = "all";
    let currentCountry = "all";
    let currentSpecialty = "all";
    let searchQuery = "";

    // Parse URL params on page load
    function parseUrlParams() {
        const params = new URLSearchParams(window.location.search);

        if (params.has("tier")) {
            currentTier = params.get("tier") || "all";
        }
        if (params.has("role")) {
            currentRole = params.get("role") || "all";
        }
        if (params.has("country")) {
            currentCountry = params.get("country") || "all";
        }
        if (params.has("specialty")) {
            currentSpecialty = params.get("specialty") || "all";
        }
        if (params.has("q")) {
            searchQuery = params.get("q") || "";
        }
    }

    // Update URL with current filter state (without page reload)
    function updateUrl() {
        const params = new URLSearchParams();

        if (currentTier !== "all") params.set("tier", currentTier);
        if (currentRole !== "all") params.set("role", currentRole);
        if (currentCountry !== "all") params.set("country", currentCountry);
        if (currentSpecialty !== "all") params.set("specialty", currentSpecialty);
        if (searchQuery) params.set("q", searchQuery);

        const newUrl = params.toString()
            ? `${window.location.pathname}?${params.toString()}`
            : window.location.pathname;

        window.history.replaceState({}, "", newUrl);
    }

    // Apply filter state to UI controls
    function applyStateToControls() {
        // Update tier buttons
        document.querySelectorAll('.filter-btn[data-group="tier"]').forEach((btn) => {
            const b = btn as HTMLButtonElement;
            b.classList.toggle("filter-btn--active", b.dataset.filter === currentTier);
        });

        // Update role buttons
        document.querySelectorAll('.filter-btn[data-group="role"]').forEach((btn) => {
            const b = btn as HTMLButtonElement;
            b.classList.toggle("filter-btn--active", b.dataset.filter === currentRole);
        });

        // Update dropdowns
        if (countrySelect) countrySelect.value = currentCountry;
        if (specialtySelect) specialtySelect.value = currentSpecialty;
        if (searchInput) searchInput.value = searchQuery;
    }

    // Main filter function
    function filterCards() {
        let visibleCount = 0;

        cards.forEach((card) => {
            const tierMatch = currentTier === "all" || card.dataset.tier === currentTier;
            const roleMatch = currentRole === "all" || card.dataset.role === currentRole;
            const countryMatch = currentCountry === "all" || card.dataset.country === currentCountry;
            const specialtyMatch = currentSpecialty === "all" ||
                (card.dataset.specialty && card.dataset.specialty.toLowerCase() === currentSpecialty.toLowerCase());

            let textMatch = true;
            if (searchQuery) {
                const searchText = `${card.dataset.name} ${card.dataset.specialty} ${card.dataset.location}`;
                textMatch = searchText.includes(searchQuery);
            }

            if (tierMatch && roleMatch && countryMatch && specialtyMatch && textMatch) {
                card.style.display = "";
                visibleCount++;
            } else {
                card.style.display = "none";
            }
        });

        // Update results info
        if (resultsInfo) {
            if (visibleCount === cards.length) {
                resultsInfo.textContent = `Showing all ${cards.length} profiles`;
            } else {
                resultsInfo.textContent = `Showing ${visibleCount} of ${cards.length} profiles`;
            }
        }

        // Show/hide empty state
        if (emptyState) {
            emptyState.hidden = visibleCount > 0;
        }

        // Update URL
        updateUrl();
    }

    // Text search with debounce
    let searchTimer: ReturnType<typeof setTimeout>;
    searchInput?.addEventListener("input", () => {
        clearTimeout(searchTimer);
        searchTimer = setTimeout(() => {
            searchQuery = searchInput.value.trim().toLowerCase();
            filterCards();
        }, 150);
    });

    // Country Filter
    countrySelect?.addEventListener("change", (e) => {
        currentCountry = (e.target as HTMLSelectElement).value;
        filterCards();
    });

    // Specialty Filter
    specialtySelect?.addEventListener("change", (e) => {
        currentSpecialty = (e.target as HTMLSelectElement).value;
        filterCards();
    });

    // Filter buttons
    buttons.forEach((btn) => {
        btn.addEventListener("click", () => {
            const group = btn.dataset.group;
            const filter = btn.dataset.filter || "all";

            if (group === "tier") {
                document.querySelectorAll('.filter-btn[data-group="tier"]')
                    .forEach((b) => b.classList.remove("filter-btn--active"));
                btn.classList.add("filter-btn--active");
                currentTier = filter;
            } else if (group === "role") {
                document.querySelectorAll('.filter-btn[data-group="role"]')
                    .forEach((b) => b.classList.remove("filter-btn--active"));
                btn.classList.add("filter-btn--active");
                currentRole = filter;
            }
            filterCards();
        });
    });

    // Handle browser back/forward navigation
    window.addEventListener("popstate", () => {
        parseUrlParams();
        applyStateToControls();
        filterCards();
    });

    // Initialize on page load
    parseUrlParams();
    applyStateToControls();
    if (currentTier !== "all" || currentRole !== "all" || currentCountry !== "all" ||
        currentSpecialty !== "all" || searchQuery) {
        filterCards();
    }
</script>

<style>
    .browse {
        padding: 48px 0 80px;
    }

    /* Header */
    .browse-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-end;
        margin-bottom: 32px;
        padding-bottom: 24px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.06);
    }

    .browse-header__text h1 {
        font-size: 2rem;
        font-weight: 700;
        color: white;
        margin-bottom: 4px;
    }

    .browse-header__text p {
        color: var(--text-muted);
        font-size: 0.95rem;
    }

    .browse-header__stats {
        display: flex;
        gap: 12px;
    }

    .mini-stat {
        font-size: 0.8rem;
        font-weight: 600;
        padding: 4px 12px;
        border-radius: 20px;
        background: rgba(255, 255, 255, 0.05);
        color: var(--text-muted);
    }

    .mini-stat--titan {
        color: #ffd700;
        background: rgba(255, 215, 0, 0.1);
    }
    .mini-stat--elite {
        color: #00aaff;
        background: rgba(0, 170, 255, 0.1);
    }
    .mini-stat--master {
        color: #00cc66;
        background: rgba(0, 204, 102, 0.1);
    }

    /* Controls */
    .browse-controls {
        display: flex;
        flex-wrap: wrap;
        gap: 24px;
        align-items: center;
        margin-bottom: 24px;
    }

    .search-wrap {
        position: relative;
        flex: 1;
        min-width: 280px;
        max-width: 400px;
    }

    .search-wrap--enhanced {
        flex: 1;
        min-width: 320px;
        max-width: 500px;
    }

    .filter-input-wrap {
        position: relative;
        min-width: 200px;
        max-width: 280px;
    }

    .filter-icon {
        position: absolute;
        left: 12px;
        top: 50%;
        transform: translateY(-50%);
        width: 16px;
        height: 16px;
        color: var(--text-muted);
        pointer-events: none;
    }

    .filter-input {
        width: 100%;
        padding: 10px 14px 10px 38px;
        font-size: 0.85rem;
        background: rgba(255, 255, 255, 0.04);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 10px;
        color: white;
        outline: none;
        transition: all 0.15s;
    }

    .filter-input::placeholder {
        color: var(--text-muted);
        font-size: 0.8rem;
    }

    .filter-input:focus {
        border-color: rgba(139, 92, 246, 0.5);
        background: rgba(255, 255, 255, 0.06);
    }

    .search-icon {
        position: absolute;
        left: 14px;
        top: 50%;
        transform: translateY(-50%);
        width: 18px;
        height: 18px;
        color: var(--text-muted);
        pointer-events: none;
    }

    .search-input {
        width: 100%;
        padding: 12px 16px 12px 44px;
        font-size: 0.9rem;
        background: rgba(255, 255, 255, 0.04);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 10px;
        color: white;
        outline: none;
        transition: all 0.15s;
    }

    .filter-select {
        padding: 8px 14px;
        font-size: 0.8rem;
        font-weight: 500;
        background: rgba(255, 255, 255, 0.04);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 8px;
        color: var(--text-secondary);
        cursor: pointer;
        transition: all 0.15s;
        outline: none;
    }

    .filter-select:hover,
    .filter-select:focus {
        background: rgba(255, 255, 255, 0.08);
        color: white;
        border-color: rgba(255, 255, 255, 0.2);
    }

    .search-input::placeholder {
        color: var(--text-muted);
    }

    .search-input:focus {
        border-color: var(--accent-purple);
        background: rgba(255, 255, 255, 0.06);
    }

    .filter-group {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .filter-label {
        font-size: 0.75rem;
        font-weight: 600;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    .filter-buttons {
        display: flex;
        gap: 6px;
    }

    .filter-btn {
        padding: 8px 14px;
        font-size: 0.8rem;
        font-weight: 500;
        background: rgba(255, 255, 255, 0.04);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 8px;
        color: var(--text-secondary);
        cursor: pointer;
        transition: all 0.15s;
    }

    .filter-btn:hover {
        background: rgba(255, 255, 255, 0.08);
        color: white;
    }

    .filter-btn--active {
        background: var(--accent-purple);
        border-color: var(--accent-purple);
        color: white;
    }

    .filter-btn--titan.filter-btn--active {
        background: rgba(255, 215, 0, 0.2);
        border-color: rgba(255, 215, 0, 0.4);
        color: #ffd700;
    }

    .filter-btn--elite.filter-btn--active {
        background: rgba(0, 170, 255, 0.2);
        border-color: rgba(0, 170, 255, 0.4);
        color: #00aaff;
    }

    .filter-btn--master.filter-btn--active {
        background: rgba(0, 204, 102, 0.2);
        border-color: rgba(0, 204, 102, 0.4);
        color: #00cc66;
    }

    /* Results Info */
    .results-info {
        font-size: 0.85rem;
        color: var(--text-muted);
        margin-bottom: 20px;
    }

    /* Grid and Cards */
    .browse-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        gap: 24px;
    }

    /* Doctor Card - Premium Glassmorphism */
    .doctor-card {
        display: flex;
        flex-direction: column;
        padding: 24px;
        background: rgba(255, 255, 255, 0.03);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 20px;
        text-decoration: none;
        color: inherit;
        transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        position: relative;
        overflow: hidden;
    }

    .doctor-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: radial-gradient(
            circle at top right,
            rgba(255, 255, 255, 0.03),
            transparent 70%
        );
        pointer-events: none;
    }

    .doctor-card:hover {
        transform: translateY(-5px);
        background: rgba(255, 255, 255, 0.05);
        border-color: rgba(255, 255, 255, 0.15);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
    }

    /* Tier Styling */
    .doctor-card--titan {
        background: linear-gradient(
            145deg,
            rgba(255, 215, 0, 0.03) 0%,
            rgba(255, 255, 255, 0.02) 100%
        );
        border-color: rgba(255, 215, 0, 0.15);
    }
    .doctor-card--titan:hover {
        border-color: rgba(255, 215, 0, 0.4);
        box-shadow: 0 20px 50px rgba(255, 215, 0, 0.1);
    }

    .doctor-card--elite {
        background: linear-gradient(
            145deg,
            rgba(0, 170, 255, 0.03) 0%,
            rgba(255, 255, 255, 0.02) 100%
        );
        border-color: rgba(0, 170, 255, 0.15);
    }
    .doctor-card--elite:hover {
        border-color: rgba(0, 170, 255, 0.4);
        box-shadow: 0 20px 50px rgba(0, 170, 255, 0.1);
    }

    .doctor-card__header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 18px;
    }

    .doctor-card__avatar {
        width: 64px;
        height: 64px;
        border-radius: 18px;
        overflow: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(255, 255, 255, 0.05);
        border: 2px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .avatar--titan {
        border-color: rgba(255, 215, 0, 0.3);
        background: rgba(255, 215, 0, 0.08);
    }

    .avatar--elite {
        border-color: rgba(0, 170, 255, 0.3);
        background: rgba(0, 170, 255, 0.08);
    }

    .avatar--master {
        border-color: rgba(0, 204, 102, 0.3);
        background: rgba(0, 204, 102, 0.08);
    }

    .doctor-card__avatar img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .avatar-initials {
        font-weight: 700;
        font-size: 0.9rem;
        color: var(--text-muted);
    }

    .avatar--titan .avatar-initials {
        color: #ffd700;
    }
    .avatar--elite .avatar-initials {
        color: #00aaff;
    }
    .avatar--master .avatar-initials {
        color: #00cc66;
    }

    .doctor-card__badges {
        display: flex;
        gap: 6px;
        align-items: center;
    }

    .legacy-badge {
        font-size: 0.7rem;
        font-weight: 500;
        padding: 3px 8px;
        border-radius: 6px;
        background: rgba(255, 255, 255, 0.05);
        color: var(--text-muted);
    }

    .doctor-card__name {
        font-size: 1.25rem;
        font-weight: 700;
        color: white;
        margin-bottom: 6px;
        line-height: 1.3;
        letter-spacing: -0.01em;
    }

    .doctor-card--titan .doctor-card__name {
        color: #ffd700;
        text-shadow: 0 2px 10px rgba(255, 215, 0, 0.2);
    }

    .doctor-card__specialty {
        font-size: 0.9rem;
        color: var(--text-secondary);
        font-weight: 500;
        margin-bottom: 4px;
    }

    .doctor-card__location {
        font-size: 0.85rem;
        color: var(--text-muted);
        margin-bottom: 16px;
        display: flex;
        align-items: center;
        gap: 4px;
    }

    .doctor-card__stats {
        display: flex;
        gap: 16px;
        padding-top: 16px;
        border-top: 1px solid rgba(255, 255, 255, 0.05);
        margin-top: auto;
    }

    .doctor-card__stats .stat {
        font-size: 0.8rem;
        color: var(--text-muted);
        display: flex;
        flex-direction: column;
        line-height: 1.2;
    }

    .doctor-card__stats .stat strong {
        color: white;
        font-weight: 700;
        font-size: 1.1rem;
        font-family: var(--font-mono, monospace);
    }

    /* Empty State */
    .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: var(--text-muted);
    }

    .empty-state svg {
        opacity: 0.4;
        margin-bottom: 16px;
    }

    .empty-state h3 {
        font-size: 1.1rem;
        color: var(--text-secondary);
        margin-bottom: 8px;
    }

    .empty-state p {
        font-size: 0.9rem;
    }

    /* Responsive */
    @media (max-width: 768px) {
        .browse-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 16px;
        }

        .browse-controls {
            flex-direction: column;
            align-items: stretch;
        }

        .search-wrap {
            max-width: none;
        }

        .filter-group {
            flex-wrap: wrap;
        }

        .browse-grid {
            grid-template-columns: 1fr;
        }
    }
</style>
