---
/**
 * MDRPedia â€” Dynamic Doctor Profile Page
 * Uses Content Collections to generate pages for each doctor
 */

import DoctorProfile from "../../layouts/DoctorProfile.astro";
import HiddenAIContext from "../../components/SEO/HiddenAIContext.astro";
import { getCollection, getEntry } from "astro:content";

export async function getStaticPaths() {
    const doctors = await getCollection("doctors");
    return doctors.map((doctor) => ({
        params: { slug: doctor.id },
    }));
}

const { slug } = Astro.params;
if (!slug) return Astro.redirect("/404");

const doctor = await getEntry("doctors", slug);
if (!doctor) return Astro.redirect("/404");

const d = doctor.data;

const profileData = {
    fullName: d.fullName,
    title: d.title,
    specialty: d.specialty,
    subSpecialty: d.subSpecialty,
    geography: d.geography,
    status: d.status as "LIVING" | "HISTORICAL",
    tier: d.tier as "TITAN" | "ELITE" | "MASTER" | "UNRANKED",
    rankingScore: d.rankingScore,
    hIndex: d.hIndex,
    yearsActive: d.yearsActive,
    verifiedSurgeries: d.verifiedSurgeries,
    biography: d.biography,
    portraitUrl: d.portraitUrl,
    galleryUrls: d.galleryUrls,
    livesSaved: d.livesSaved,
    techniquesInvented: d.techniquesInvented,
    hasInvention: d.hasInvention,
    dateOfBirth: d.dateOfBirth,
    dateOfDeath: d.dateOfDeath,
    citations: d.citations,
    awards: d.awards,
    timeline: d.timeline,
    // E-E-A-T Fields
    npiNumber: d.npiNumber,
    orcidId: d.orcidId,
    medicalSpecialty: d.medicalSpecialty,
    knowsAbout: d.knowsAbout,
    affiliations: d.affiliations,
    mentors: d.mentors,
    students: d.students,
    aiSummary: d.aiSummary,
};
---

<HiddenAIContext doctor={doctor} />
<DoctorProfile doctor={profileData} />
